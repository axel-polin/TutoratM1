#include <stdio.h>
#include <string.h>
#include <stdlib.h>

char *input(char *str,char *message,u_int32_t input_max_len);
void *ec_malloc(u_int32_t nb,u_int32_t size);
void fatal(const char *message);
void clean(const char *buffer,FILE *fp);
char *input(char *str,char *message,u_int32_t input_max_len);


int main (){
char *str = ec_malloc(100,sizeof(char));
char password[10]="password";

input(str,"Password ??",99);

if( ! strcmp(str,password) ){
  printf("You find the good password\n");
}

return 0;  
}

char *input(char *str,char *message,u_int32_t input_max_len){
  
  if(message)
    printf("%s\n",message);
  
  if(fgets(str,input_max_len,stdin)==NULL) // get enzyme name
    fatal("while acquiring strings from keyboard");
  clean(str,stdin); // always clean keyboard buffer before continue
  
  return str;  
}

void *ec_malloc(u_int32_t nb,u_int32_t size){
void *ptr = NULL;
   ptr = calloc(nb,size);
   if(ptr == NULL)
      fatal("in ec_malloc() on memory allocation");
   return ptr;
}

void fatal(const char *message) {
	char error_message[100];
	char message_fatal[100]="[!!] Fatal Error ";
	strcpy(error_message, message_fatal);
	strncat(error_message, message, 83);
	perror(error_message);
	exit(-1);
}

void clean(const char *buffer,FILE *fp){
char *p=strchr(buffer,'\n');
	if(p!=NULL)
		*p=0;
	else {
		int32_t c;
		while((c=fgetc(fp))!='\n'&& c!= EOF);
	}
}
